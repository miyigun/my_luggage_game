<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Öncelikli Geçiş - Bagaj Lojistik Merkezi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { margin: 0; background: #0f172a; user-select: none; touch-action: none; }
        .cursor-grab { cursor: grab; }
        .cursor-grabbing { cursor: grabbing; }
    </style>
</head>
<body class="min-h-screen w-full bg-slate-900 text-slate-100 flex flex-col items-center justify-center p-4 font-sans overflow-hidden">

    <div id="game-container" class="w-full flex flex-col items-center">
        <!-- Header -->
        <div class="w-full max-w-lg flex justify-between items-center mb-6 gap-4">
            <div>
                <h1 class="text-2xl font-black tracking-tighter text-yellow-500 flex items-center gap-2 whitespace-nowrap">
                    <i data-lucide="plane" class="rotate-45"></i> ÖNCELİKLİ GEÇİŞ
                </h1>
                <p class="text-xs text-slate-400 font-mono">
                    BAGAJ LOJİSTİK MERKEZİ v1.0 <span class="text-yellow-500/50 mx-2">|</span> 
                    <span id="level-name" class="text-slate-300"></span>
                </p>
            </div>
            <div class="flex gap-3">
                <div class="bg-slate-800 px-3 py-1 rounded-lg border border-slate-700 text-center">
                    <div class="text-[10px] text-slate-500 uppercase">Hamle</div>
                    <div id="moves-count" class="text-lg font-bold font-mono">0</div>
                </div>
                <button onclick="resetLevel()" class="bg-slate-800 p-2 rounded-lg border border-slate-700 hover:bg-slate-700 active:scale-95 transition-all">
                    <i data-lucide="rotate-ccw" size="20"></i>
                </button>
            </div>
        </div>

        <!-- Game Board -->
        <div class="relative">
            <div id="board" class="relative bg-slate-800 rounded-xl overflow-hidden shadow-2xl border-4 border-slate-700 p-0" style="width: 360px; height: 360px;">
                <!-- Grid Lines -->
                <div class="absolute inset-0 grid grid-cols-6 grid-rows-6 pointer-events-none">
                    <!-- Grid cells will be generated by JS -->
                </div>

                <!-- Exit Gate Laser -->
                <div class="absolute top-[120px] right-0 w-1 h-[60px] bg-red-500 shadow-[0_0_10px_#ef4444] animate-pulse z-30"></div>
                <div class="absolute top-[135px] -right-8 text-[10px] font-bold text-red-500 rotate-90 uppercase tracking-widest z-30">
                    YÜKLEME HATTI
                </div>

                <!-- Blocks Container -->
                <div id="blocks-container"></div>
            </div>

            <!-- Win Modal Overlay -->
            <div id="win-modal" class="hidden absolute inset-0 z-50 flex items-center justify-center bg-slate-900/80 backdrop-blur-sm rounded-xl">
                <div class="bg-slate-800 p-8 rounded-2xl border-2 border-yellow-500 text-center shadow-[0_0_50px_rgba(234,179,8,0.3)] animate-in zoom-in duration-300">
                    <div class="w-16 h-16 bg-yellow-500 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg">
                        <i data-lucide="trophy" class="text-slate-900" size="32"></i>
                    </div>
                    <h2 class="text-2xl font-black text-white mb-2">GÖREV TAMAM!</h2>
                    <p class="text-slate-400 mb-6 text-sm">Bavul uçağa zamanında yetişti.<br/><span id="win-moves">0</span> hamlede başardın.</p>
                    <button onclick="nextLevel()" class="w-full py-3 bg-yellow-500 text-slate-900 font-bold rounded-xl hover:bg-yellow-400 active:scale-95 transition-all flex items-center justify-center gap-2">
                        SONRAKİ TERMİNAL <i data-lucide="chevron-right" size="20"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Footer Info -->
        <div class="mt-8 max-w-md text-center">
            <div class="flex items-center justify-center gap-6 text-slate-500 text-sm mb-4">
                <div class="flex items-center gap-2">
                    <div class="w-3 h-3 bg-yellow-500 rounded-sm"></div> Öncelikli
                </div>
                <div class="flex items-center gap-2">
                    <div class="w-3 h-3 bg-slate-700 rounded-sm"></div> Standart
                </div>
                <div class="flex items-center gap-2">
                    <div class="w-3 h-3 bg-slate-600 rounded-sm"></div> Ağır Kargo
                </div>
            </div>
            <p class="text-[10px] text-slate-600 leading-relaxed uppercase tracking-widest">
                Dikkat: Uçuş güvenliği için valizleri sadece ray hattı üzerinde hareket ettirin. Çıkış kapısı sağ taraftaki kırmızı lazerli alandır.
            </p>
        </div>
    </div>

    <!-- Game Completed Screen -->
    <div id="completion-screen" class="hidden min-h-screen w-full bg-slate-900 text-slate-100 flex flex-col items-center justify-center p-4 font-sans select-none animate-in fade-in duration-500 fixed inset-0 z-50">
        <div class="max-w-md w-full bg-slate-800 p-8 rounded-2xl border-2 border-yellow-500 text-center shadow-2xl">
            <div class="w-24 h-24 bg-yellow-500 rounded-full flex items-center justify-center mx-auto mb-6 shadow-lg animate-bounce">
                <i data-lucide="trophy" class="text-slate-900" width="48" height="48"></i>
            </div>
            <h1 class="text-4xl font-black text-white mb-2 tracking-tighter">TEBRİKLER!</h1>
            <p class="text-slate-400 mb-8 text-lg">Tüm uçuşlar başarıyla tamamlandı.</p>
            
            <div class="grid grid-cols-2 gap-4 mb-8">
                <div class="bg-slate-900/50 p-4 rounded-xl border border-slate-700">
                    <div class="text-xs text-slate-500 uppercase mb-1">Toplam Hamle</div>
                    <div id="total-moves" class="text-3xl font-mono font-bold text-yellow-500">0</div>
                </div>
                <div class="bg-slate-900/50 p-4 rounded-xl border border-slate-700">
                    <div class="text-xs text-slate-500 uppercase mb-1">Performans</div>
                    <div id="performance-text" class="text-xl font-bold text-green-400">İYİ</div>
                </div>
            </div>

            <button onclick="restartGame()" class="w-full py-4 bg-yellow-500 text-slate-900 font-bold text-lg rounded-xl hover:bg-yellow-400 active:scale-95 transition-all flex items-center justify-center gap-2">
                <i data-lucide="rotate-ccw" width="24" height="24"></i> YENİDEN BAŞLA
            </button>
        </div>
    </div>

    <script>
        // --- Sabitler ---
        const GRID_SIZE = 6;
        const CELL_SIZE = 60;

        const INITIAL_LEVELS = [
            {
                id: 1,
                name: 'İSTANBUL - İÇ HATLAR',
                targetBlock: { id: 'priority', x: 0, y: 2, len: 2, axis: 'h', type: 'priority' },
                blocks: [
                    { id: 'b1', x: 2, y: 0, len: 3, axis: 'v', type: 'cargo' },
                    { id: 'b2', x: 3, y: 1, len: 2, axis: 'h', type: 'bag' },
                    { id: 'b3', x: 3, y: 2, len: 2, axis: 'v', type: 'bag' },
                    { id: 'b4', x: 4, y: 3, len: 2, axis: 'v', type: 'bag' },
                    { id: 'b5', x: 0, y: 4, len: 3, axis: 'h', type: 'cargo' },
                ]
            },
            {
                id: 2,
                name: 'LONDRA - AKTARMA',
                targetBlock: { id: 'priority', x: 1, y: 2, len: 2, axis: 'h', type: 'priority' },
                blocks: [
                    { id: 'b1', x: 0, y: 0, len: 2, axis: 'v', type: 'bag' },
                    { id: 'b2', x: 1, y: 0, len: 2, axis: 'h', type: 'bag' },
                    { id: 'b3', x: 3, y: 1, len: 2, axis: 'v', type: 'bag' },
                    { id: 'b4', x: 4, y: 0, len: 3, axis: 'v', type: 'cargo' },
                    { id: 'b5', x: 5, y: 1, len: 2, axis: 'v', type: 'bag' },
                    { id: 'b6', x: 0, y: 3, len: 3, axis: 'h', type: 'cargo' },
                    { id: 'b7', x: 3, y: 4, len: 2, axis: 'v', type: 'bag' },
                ]
            },
            {
                id: 3,
                name: 'NEW YORK - JFK',
                targetBlock: { id: 'priority', x: 0, y: 2, len: 2, axis: 'h', type: 'priority' },
                blocks: [
                    { id: 'b1', x: 0, y: 0, len: 2, axis: 'v', type: 'bag' },
                    { id: 'b2', x: 1, y: 0, len: 2, axis: 'h', type: 'bag' },
                    { id: 'b3', x: 1, y: 1, len: 2, axis: 'h', type: 'bag' },
                    { id: 'b4', x: 3, y: 0, len: 3, axis: 'v', type: 'cargo' },
                    { id: 'b5', x: 1, y: 3, len: 3, axis: 'h', type: 'cargo' },
                    { id: 'b6', x: 4, y: 0, len: 2, axis: 'h', type: 'bag' },
                    { id: 'b7', x: 4, y: 3, len: 2, axis: 'v', type: 'bag' },
                    { id: 'b8', x: 5, y: 2, len: 2, axis: 'v', type: 'bag' },
                    { id: 'b9', x: 0, y: 4, len: 3, axis: 'h', type: 'cargo' },
                    { id: 'b10', x: 4, y: 5, len: 2, axis: 'h', type: 'bag' },
                ]
            },
            {
                id: 4,
                name: 'TOKYO - HANEDA',
                targetBlock: { id: 'priority', x: 0, y: 2, len: 2, axis: 'h', type: 'priority' },
                blocks: [
                    { id: 'b1', x: 0, y: 0, len: 2, axis: 'h', type: 'bag' },
                    { id: 'b2', x: 2, y: 0, len: 3, axis: 'h', type: 'cargo' },
                    { id: 'b3', x: 5, y: 0, len: 3, axis: 'v', type: 'cargo' },
                    { id: 'b4', x: 0, y: 3, len: 2, axis: 'v', type: 'bag' },
                    { id: 'b5', x: 2, y: 1, len: 2, axis: 'v', type: 'bag' },
                    { id: 'b6', x: 3, y: 1, len: 2, axis: 'v', type: 'bag' },
                    { id: 'b7', x: 2, y: 3, len: 2, axis: 'h', type: 'bag' },
                    { id: 'b8', x: 4, y: 2, len: 2, axis: 'v', type: 'bag' },
                    { id: 'b9', x: 0, y: 5, len: 2, axis: 'h', type: 'bag' },
                    { id: 'b10', x: 2, y: 5, len: 2, axis: 'h', type: 'bag' },
                ]
            },
            {
                id: 5,
                name: 'DUBAI - KARGO',
                targetBlock: { id: 'priority', x: 0, y: 2, len: 2, axis: 'h', type: 'priority' },
                blocks: [
                    { id: 'b1', x: 0, y: 0, len: 2, axis: 'v', type: 'bag' },
                    { id: 'b2', x: 1, y: 0, len: 2, axis: 'h', type: 'bag' },
                    { id: 'b3', x: 3, y: 0, len: 3, axis: 'v', type: 'cargo' },
                    { id: 'b4', x: 4, y: 1, len: 2, axis: 'v', type: 'bag' },
                    { id: 'b5', x: 2, y: 2, len: 2, axis: 'v', type: 'bag' },
                    { id: 'b6', x: 4, y: 3, len: 2, axis: 'h', type: 'bag' },
                    { id: 'b7', x: 0, y: 3, len: 2, axis: 'h', type: 'bag' },
                    { id: 'b8', x: 0, y: 4, len: 2, axis: 'v', type: 'bag' },
                    { id: 'b9', x: 2, y: 4, len: 2, axis: 'h', type: 'bag' },
                    { id: 'b10', x: 4, y: 5, len: 2, axis: 'h', type: 'bag' },
                    { id: 'b11', x: 2, y: 5, len: 2, axis: 'h', type: 'bag' },
                ]
            }
        ];

        // --- State ---
        let currentLevelIdx = 0;
        let blocks = [];
        let moves = 0;
        let isWon = false;
        let isGameCompleted = false;
        let totalMoves = 0;
        let draggingId = null;
        let dragStart = { x: 0, y: 0 };
        let initialBlockPos = { x: 0, y: 0 };

        // --- DOM Elements ---
        const boardEl = document.getElementById('board');
        const blocksContainerEl = document.getElementById('blocks-container');
        const levelNameEl = document.getElementById('level-name');
        const movesCountEl = document.getElementById('moves-count');
        const winModalEl = document.getElementById('win-modal');
        const winMovesEl = document.getElementById('win-moves');
        const completionScreenEl = document.getElementById('completion-screen');
        const totalMovesEl = document.getElementById('total-moves');
        const performanceTextEl = document.getElementById('performance-text');
        const gameContainerEl = document.getElementById('game-container');

        // --- Init ---
        function initGrid() {
            const gridContainer = document.querySelector('.grid');
            let html = '';
            for(let i=0; i<36; i++) {
                html += `<div class="border-[0.5px] border-slate-700/50 flex items-center justify-center"><div class="w-1 h-1 bg-slate-600 rounded-full opacity-20"></div></div>`;
            }
            document.querySelector('.grid').innerHTML = html;
        }
        initGrid();
        loadLevel();
        lucide.createIcons();

        // --- Functions ---
        function loadLevel() {
            const level = INITIAL_LEVELS[currentLevelIdx];
            blocks = [level.targetBlock, ...level.blocks].map(b => ({...b})); // Deep copy needed? Simple copy is fine for this structure
            moves = 0;
            isWon = false;
            
            levelNameEl.textContent = level.name;
            movesCountEl.textContent = moves;
            winModalEl.classList.add('hidden');
            
            renderBlocks();
        }

        function renderBlocks() {
            blocksContainerEl.innerHTML = '';
            blocks.forEach(block => {
                const el = document.createElement('div');
                el.id = `block-${block.id}`;
                el.className = `absolute cursor-grab active:cursor-grabbing transition-shadow rounded-lg flex items-center justify-center overflow-hidden ${block.type === 'priority' ? 'z-20 ring-2 ring-yellow-400' : 'z-10'} shadow-md`;
                
                // Style
                el.style.width = `${block.axis === 'h' ? block.len * 60 - 4 : 56}px`;
                el.style.height = `${block.axis === 'v' ? block.len * 60 - 4 : 56}px`;
                el.style.left = `${block.x * 60 + 2}px`;
                el.style.top = `${block.y * 60 + 2}px`;
                el.style.backgroundColor = block.type === 'priority' ? '#eab308' : block.type === 'cargo' ? '#334155' : '#475569';
                if (block.type === 'priority') el.style.backgroundImage = 'linear-gradient(135deg, #eab308 0%, #ca8a04 100%)';
                el.style.border = `2px solid ${block.type === 'priority' ? '#fde047' : '#1e293b'}`;

                // Content
                let content = '';
                if (block.type === 'priority') {
                    content = `
                        <div class="flex flex-col items-center text-slate-900 opacity-100 pointer-events-none">
                            <i data-lucide="alert-circle" width="24" height="24"></i>
                            <span class="text-[8px] font-black uppercase mt-1 tracking-tighter">ÖNCELİKLİ</span>
                        </div>
                    `;
                } else if (block.type === 'cargo') {
                    content = `<div class="opacity-40 text-white pointer-events-none"><i data-lucide="package" width="20" height="20"></i></div>`;
                } else {
                    content = `<div class="w-4 h-1 bg-white/20 rounded-full pointer-events-none"></div>`;
                }
                
                // Grip lines
                const gripClass = block.axis === 'h' ? 'right-2 flex-col' : 'bottom-2 flex-row';
                const grip = `
                    <div class="absolute ${block.axis === 'h' ? 'right-2' : 'bottom-2'} flex gap-1 pointer-events-none">
                        <div class="w-1 h-1 bg-white/20 rounded-full"></div>
                        <div class="w-1 h-1 bg-white/20 rounded-full"></div>
                    </div>
                `;

                el.innerHTML = content + grip;

                // Events
                el.addEventListener('mousedown', (e) => handleStart(e, block.id));
                el.addEventListener('touchstart', (e) => handleStart(e, block.id), {passive: false});

                blocksContainerEl.appendChild(el);
            });
            lucide.createIcons();
        }

        function canMoveTo(blockId, newX, newY, currentBlocks) {
            const block = currentBlocks.find(b => b.id === blockId);
            
            if (newX < 0 || newY < 0) return false;
            if (block.axis === 'h' && newX + block.len > GRID_SIZE) return false;
            if (block.axis === 'v' && newY + block.len > GRID_SIZE) return false;
            if (block.axis === 'h' && newY >= GRID_SIZE) return false;
            if (block.axis === 'v' && newX >= GRID_SIZE) return false;

            for (const b of currentBlocks) {
                if (b.id === blockId) continue;
                
                const bCells = [];
                for(let i=0; i<b.len; i++) {
                    bCells.push(b.axis === 'h' ? {x: b.x + i, y: b.y} : {x: b.x, y: b.y + i});
                }

                for(let i=0; i<block.len; i++) {
                    const currX = block.axis === 'h' ? newX + i : newX;
                    const currY = block.axis === 'v' ? newY + i : newY;
                    if (bCells.some(c => c.x === currX && c.y === currY)) return false;
                }
            }
            return true;
        }

        function handleStart(e, id) {
            if (isWon) return;
            e.preventDefault(); // Prevent scrolling on touch
            
            const clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
            const clientY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;
            
            const block = blocks.find(b => b.id === id);
            draggingId = id;
            dragStart = { x: clientX, y: clientY };
            initialBlockPos = { x: block.x, y: block.y };

            const el = document.getElementById(`block-${id}`);
            el.classList.add('shadow-xl', 'scale-[1.02]', 'z-30');
        }

        function handleMove(e) {
            if (!draggingId) return;
            e.preventDefault();

            const clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
            const clientY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;

            const dx = (clientX - dragStart.x) / 60;
            const dy = (clientY - dragStart.y) / 60;

            const block = blocks.find(b => b.id === draggingId);
            let newX = initialBlockPos.x;
            let newY = initialBlockPos.y;

            if (block.axis === 'h') {
                newX = Math.round(initialBlockPos.x + dx);
            } else {
                newY = Math.round(initialBlockPos.y + dy);
            }

            const step = (block.axis === 'h' ? newX - block.x : newY - block.y);
            if (step === 0) return;

            const dir = step > 0 ? 1 : -1;
            let finalX = block.x;
            let finalY = block.y;

            for (let i = 1; i <= Math.abs(step); i++) {
                const testX = block.axis === 'h' ? block.x + (i * dir) : block.x;
                const testY = block.axis === 'v' ? block.y + (i * dir) : block.y;
                
                if (canMoveTo(draggingId, testX, testY, blocks)) {
                    finalX = testX;
                    finalY = testY;
                } else {
                    break;
                }
            }

            if (finalX !== block.x || finalY !== block.y) {
                block.x = finalX;
                block.y = finalY;
                
                // Update DOM directly for performance
                const el = document.getElementById(`block-${draggingId}`);
                el.style.left = `${block.x * 60 + 2}px`;
                el.style.top = `${block.y * 60 + 2}px`;
            }
        }

        function handleEnd() {
            if (draggingId) {
                const block = blocks.find(b => b.id === draggingId);
                const el = document.getElementById(`block-${draggingId}`);
                el.classList.remove('shadow-xl', 'scale-[1.02]', 'z-30');

                if (block.x !== initialBlockPos.x || block.y !== initialBlockPos.y) {
                    moves++;
                    movesCountEl.textContent = moves;
                }
                
                const targetBlock = INITIAL_LEVELS[currentLevelIdx].targetBlock;
                if (block.id === 'priority' && block.x === 4 && block.y === targetBlock.y) {
                    isWon = true;
                    winMovesEl.textContent = moves;
                    winModalEl.classList.remove('hidden');
                }
            }
            draggingId = null;
        }

        function resetLevel() {
            loadLevel();
        }

        function nextLevel() {
            totalMoves += moves;
            if (currentLevelIdx < INITIAL_LEVELS.length - 1) {
                currentLevelIdx++;
                loadLevel();
            } else {
                showCompletionScreen();
            }
        }

        function showCompletionScreen() {
            isGameCompleted = true;
            gameContainerEl.classList.add('hidden');
            completionScreenEl.classList.remove('hidden');
            
            totalMovesEl.textContent = totalMoves;
            
            let performance = 'GELİŞTİRİLEBİLİR';
            let colorClass = 'text-red-400';
            
            if (totalMoves < 100) {
                performance = 'MÜKEMMEL';
                colorClass = 'text-green-400';
            } else if (totalMoves < 150) {
                performance = 'İYİ';
                colorClass = 'text-blue-400';
            }
            
            performanceTextEl.textContent = performance;
            performanceTextEl.className = `text-xl font-bold ${colorClass}`;
            lucide.createIcons();
        }

        function restartGame() {
            isGameCompleted = false;
            currentLevelIdx = 0;
            totalMoves = 0;
            completionScreenEl.classList.add('hidden');
            gameContainerEl.classList.remove('hidden');
            loadLevel();
        }

        // Global Event Listeners
        document.addEventListener('mousemove', handleMove);
        document.addEventListener('mouseup', handleEnd);
        document.addEventListener('touchmove', handleMove, {passive: false});
        document.addEventListener('touchend', handleEnd);

    </script>
</body>
</html>